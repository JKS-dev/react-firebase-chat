import{r as u,j as e}from"./jsx-runtime-D2HyDbKh.js";import{i as D,u as N,l as A,N as P,B as n,c as q,q as R,w as F,g as I,v as k,k as m,r as C,s as x,a as j,d as p,x as O}from"./Notification-CX8TBnOe.js";function z(){const h=D(),{currentUser:f,isLoading:w,fetchUserInfo:g}=N(),[d,y]=u.useState({file:null,url:""}),[l,c]=u.useState(!1),v=a=>{a.target.files[0]&&y({file:a.target.files[0],url:URL.createObjectURL(a.target.files[0])})},b=async a=>{a.preventDefault(),c(!0);const s=new FormData(a.target),{username:r,email:i,password:o}=Object.fromEntries(s);if(!r||!i||!o)return n.warn("Please enter inputs!");if(!d.file)return n.warn("Please upload an avatar!");const L=q(p,"users"),U=R(L,F("username","==",r));if(!(await I(U)).empty)return n.warn("Select another username");try{const t=await k(m,i,o),E=await C(d.file);await x(j(p,"users",t.user.uid),{username:r,email:i,avatar:E,id:t.user.uid,blocked:[],windowId:null}),await x(j(p,"userchats",t.user.uid),{chats:[]}),n.success("Account created! You can login now!")}catch(t){console.log(t),n.error(t.message)}finally{c(!1)}},S=async a=>{a.preventDefault(),c(!0);const s=new FormData(a.target),{email:r,password:i}=Object.fromEntries(s);try{await O(m,r,i).then(()=>{h("/")})}catch(o){console.log(o),n.error(o.message)}finally{c(!1)}};return u.useEffect(()=>{const a=A(m,s=>{g(s==null?void 0:s.uid)});return()=>{a()}},[g]),console.log(f),w?e.jsx("div",{className:"loading",children:"Loading..."}):e.jsxs(e.Fragment,{children:[f?h("/"):e.jsxs("div",{className:"login",children:[e.jsxs("div",{className:"item",children:[e.jsx("h2",{children:"Welcome back,"}),e.jsxs("form",{onSubmit:S,children:[e.jsx("input",{type:"text",placeholder:"Email",name:"email"}),e.jsx("input",{type:"password",placeholder:"Password",name:"password"}),e.jsx("button",{disabled:l,children:l?"Loading":"Sign In"})]})]}),e.jsx("div",{className:"separator"}),e.jsxs("div",{className:"item",children:[e.jsx("h2",{children:"Create an Account"}),e.jsxs("form",{onSubmit:b,children:[e.jsxs("label",{htmlFor:"file",children:[e.jsx("img",{src:d.url||"./avatar.png",alt:""}),"Upload an image"]}),e.jsx("input",{type:"file",id:"file",style:{display:"none"},onChange:v}),e.jsx("input",{type:"text",placeholder:"Username",name:"username"}),e.jsx("input",{type:"text",placeholder:"Email",name:"email"}),e.jsx("input",{type:"password",placeholder:"Password",name:"password"}),e.jsx("button",{disabled:l,children:l?"Loading":"Sign Up"})]})]})]}),e.jsx(P,{})]})}export{z as L};
